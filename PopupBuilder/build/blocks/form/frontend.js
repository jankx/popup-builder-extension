(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=(e,t)=>{let o=e.getAttribute("id");o=o.replace("popup-builder-","");const{entrAnimation:r,exitAnimation:n,animationDuration:s,type:i}=t||{},p=e.querySelector(".popup-builder-container");p.classList.remove(`${r}`),p.classList.add(`${n}`),p.classList.add("reverse"),setTimeout(()=>{["popup","full-screen"].includes(i)&&t?.preventScroll&&(window.parent.document.body.style.overflow=""),e.classList.remove("popup-builder-modal--open"),p.classList.remove(`${n}`),p.classList.remove("reverse"),window.frameElement&&window.frameElement.remove()},1e3*s)},o=function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},r=window.wp.apiFetch;var n=e.n(r);const s=(e,t)=>{e&&!o(`pbb_conversion_${t}`)&&((e,t)=>{const o=Number(sessionStorage.getItem("pbb_logs"));location.search.includes("iframe=true")&&n()({path:"/pbb/v1/popup/logs",method:"PUT",data:{id:o,...e}}).then(e=>{t&&t(e)})})({converted:!0,refferer:window.parent.document.referrer},e=>{"success"===e.status?function(e,t,o){let r=`${e}=${t}; path=/`;if(o){const e=new Date;e.setTime(e.getTime()+60*o*60*1e3),r+=`; expires=${e.toUTCString()}`}document.cookie=r}(`pbb_conversion_${t}`,"true",8760):console.error("Error updating conversion count:",e.message)})},i=e=>{const t=JSON.parse(e.getAttribute("data-settings"));return{popupID:e.getAttribute("id").replace("popup-builder-",""),popupAttributes:t}},p=/^(mailto:)?[a-z0-9._%+-]+@[a-z0-9][a-z0-9.-]*\.[a-z]{2,63}$/i;function a(e){return p.test(e)}const c=/^(tel:)?(\+)?\d{6,15}$/;function l(e){return e=e.replace(/[-.() ]/g,""),c.test(e)}const u=window.wp.hooks;window.addEventListener("load",()=>{const e=document.querySelectorAll(".pbb-form");if(!e.length)return;const r=document.querySelector('[data-block="popup-builder-block/coupon-wheel"]'),p=document.querySelector('[data-block="popup-builder-block/step"]');for(const c of e){const e=c.querySelector('input[type="email"]'),m=c.querySelector('input[type="tel"]'),b=c.querySelector(".pbb-form__submit-btn"),y=JSON.parse(c.getAttribute("data-settings")),{action:f,redirectURL:w,email:v,phone:h,copyText:g,newWindowURL:S,closeCampaign:C,istrackConversion:_,integration:q,message:k,closeCampaignDelay:x=3,step:$}=y||{},E=c.closest(".popup-builder-modal"),{popupID:L,popupAttributes:T}=i(E),A=Array.from(c.querySelectorAll("[required]")),I=e=>e.closest(".pbb-form__field").querySelector(".error-message"),K=(e,t)=>{const o=document.createElement("div");o.classList.add("error-message"),o.textContent=t,e.parentElement.insertAdjacentElement("afterend",o)},O=(e,t,o)=>{const r=t(e.value),n=I(e);r?n&&n.remove():(n||K(e,`Please enter a valid ${o}`),e.focus())};c.addEventListener("submit",async i=>{i.preventDefault();for(const e of A){const t=I(e);if(e.value)t&&t.remove();else{if(t)continue;K(e,"This field is required"),e.focus()}}if(e&&O(e,a,"email"),m&&O(m,l,"phone number"),c.querySelector(".error-message"))return;const N=document.createElement("span");N.classList.add("pbb-form-loader"),b.append(N),b.querySelector(".btn-text").style.opacity=0;const D=new FormData(c,b),P={popup_id:L,form_data:{},user_data:o("pbb_user_info")||{}};for(const[e,t]of D)"email"!==e&&"name"!==e?P.form_data[e]=t.trim():P[e]=t.trim();let z=!1;if(q){if(q?.mailchimp){const{apiKey:e,listId:t,doubleOptin:o}=q.mailchimp;P.mailchimp={apiKey:e,listId:t,doubleOptin:o},z=!0}if(q?.fluentCRM){const{apiKey:e}=q.fluentCRM;P.fluentCRM={apiKey:e},z=!0}if(q?.activeCampaign){const{apiKey:e,listId:t}=q.activeCampaign;P.activeCampaign={apiKey:e,listId:t},z=!0}if(q?.zapier){const{apiKey:e,listId:t}=q.zapier;P.zapier={apiKey:e,listId:t},z=!0}if(q?.hubspot){const{apiKey:e,listId:t}=q.hubspot;P.hubspot={apiKey:e,listId:t},z=!0}if(q?.pabbly){const{apiKey:e}=q.pabbly;P.pabbly={apiKey:e},z=!0}if(q?.aweber){const{apiKey:e}=q.aweber;P.aweber={apiKey:e},z=!0}}if(z&&(P.third_party_integration=!0),"true"===sessionStorage.getItem(`pbb_submitted_${L}`))return b.querySelector(".pbb-form-loader").remove(),b.querySelector(".btn-text").style.opacity=1,c.querySelector(".pbb-form-success")?.remove(),void K(b,"You have already submitted this form.");let M=null;r&&((0,u.doAction)("popup.triggerSpinWheel",!0),M=await new Promise(e=>{(0,u.addAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler",t=>{e(t),(0,u.removeAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler")})}));const F=(0,u.applyFilters)("popup.wheelCouponCode",null,!0);M&&!p&&d(".wp-block-popup-builder-block-form",`\n\t\t\t\t\t<div class="popup-builder-coupon-wheel-result">\n      \t\t\t\t\t<h1 class="popup-builder-coupon-wheel-title">${F?.success?.wheelSuccessMessage}</h1>\n      \t\t\t\t\t<p class="popup-builder-coupon-wheel-description">${F?.success?.wheelSuccessDescription}</p>\n      \t\t\t\t\t<div class="popup-builder-coupon-code-wrapper">\n      \t\t\t\t\t\t<span class="popup-builder-coupon-code-label">${F?.success?.wheelCouponCodeLabel}</span>\n        \t\t\t\t\t<span class="popup-builder-coupon-code-text">${F?.couponCode}</span>\n      \t\t\t\t\t</div>\n    \t\t\t\t</div>\n \t\t \t\t\t`);const H=()=>{switch(f){case"redirect-url":window.location.href=w;break;case"email":window.location.href=`mailto:${v}`;break;case"call":window.location.href=`tel:${h}`;break;case"copy-text":navigator.clipboard.writeText(g);break;case"new-window":window.open(S,"_blank");break;case"step":const e=(0,u.applyFilters)("popupkit.steps.form",""),t=document.querySelectorAll(".wp-block-popup-builder-block-step");for(const e of t)e.classList.contains("active")&&e.classList.remove("active");const o=e[parseInt($)];if(o.classList.add("active"),p&&p){const e=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null,!1);for(;e.nextNode();){const t=e.currentNode;t.nodeValue.includes("{{coupon_code}}")&&(t.nodeValue=t.nodeValue.replace("{{coupon_code}}",F?.couponCode))}}document.querySelector(".popupkit-steps-inner").insertBefore(o,t[parseInt(y.step)])}};if(location.search.includes("iframe=true"))n()({path:"/pbb/v1/subscribers",method:"POST",body:JSON.stringify(P)}).then(e=>{b.querySelector(".pbb-form-loader").remove(),b.querySelector(".btn-text").style.opacity=1;const o=window.getComputedStyle(b).getPropertyValue("position"),r=document.createElement("div");r.className="pbb-form-success",r.textContent=k,"absolute"===o?c.querySelector(".pbb-form__field-0").append(r):b.parentElement.append(r),sessionStorage.setItem(`pbb_submitted_${L}`,"true"),c.reset(),b.disabled=!0,C&&setTimeout(()=>{t(E,T)},1e3*x),s(_,L),H()});else{b.querySelector(".pbb-form-loader").remove(),b.querySelector(".btn-text").style.opacity=1;const e=window.getComputedStyle(b).getPropertyValue("position"),o=document.createElement("div");o.className="pbb-form-success",o.textContent=k,"absolute"===e?c.querySelector(".pbb-form__field-0").append(o):b.parentElement.append(o),c.reset(),b.disabled=!0,C&&setTimeout(()=>{t(E,T)},1e3*x),H()}})}});const d=(e,t)=>{const o=document.querySelector(e);if(!o)return;const r=document.createElement("div");r.innerHTML=t.trim(),o.innerHTML="",Array.from(r.childNodes).forEach(e=>{o.appendChild(e)});const n=document.querySelector(".popup-builder-coupon-code-wrapper");n?.addEventListener("click",()=>{const e=n.querySelector(".popup-builder-coupon-code-text"),t=e.textContent;(async e=>{try{await navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.error("Copy failed",e)}document.body.removeChild(t)}})(t).then(()=>{e.textContent="COPIED!",setTimeout(()=>e.textContent=t,3e3)})})}})();